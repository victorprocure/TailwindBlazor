<?xml version="1.0" encoding="utf-8" ?>
<Project ToolsVersion="12.0"
  xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <NodeCli Condition=" '$(NodeCli)'=='' ">npm</NodeCli>
    <NodeXCli Condition=" '$(NodeXCli)'=='' ">npx</NodeXCli>
    <TailwindCssConfigFile Condition=" '$(TailwindCssConfigFile)'=='' ">$(MSBuildThisFileDirectory)../content/tailwind.config.js</TailwindCssConfigFile>
    <TailwindCssCli Condition=" '$(TailwindCssRunner)'=='' ">tailwindcss</TailwindCssCli>
    <TailwindCssOutputFile Condition=" '$(TailwindCssOutputFile)'=='' ">$(MSBuildProjectDirectory)/wwwroot/app.css</TailwindCssOutputFile>
    <TailwindCssInputFile Condition=" '$(TailwindCssInputFile)'=='' ">$(MSBuildThisFileDirectory)../content/input.css</TailwindCssInputFile>
    <TailwindCssMinify Condition=" '$(TailwindCssMinify)'=='' ">false</TailwindCssMinify>

    <TailwindCssMinifyCommand Condition=" '$(TailwindCssMinify)'=='true' ">--minify</TailwindCssMinifyCommand>
    <TailwindCssMinifyCommand Condition=" '$(TailwindCssMinify)'=='false' "></TailwindCssMinifyCommand>
  </PropertyGroup>



  <Target Name="DebugEnsureNode" BeforeTargets="Build" Condition=" '$(Configuration)'=='Debug' ">
    <Exec Command="$(NodeCli) --version" ContinueOnError="true">
      <Output TaskParameter="ExitCode" PropertyName="ErrorCode" />
    </Exec>
    <Error Condition=" '$(ErrorCode)' != '0' " Text="NodeJS and NPM are required. To continue please install node.js from https://nodejs.org and restart this command prompt or IDE" />
    <Message Importance="high" Text="Installing tailwindCSS using 'npm'" />
    <Exec WorkingDirectory="$(MSBuildThisFileDirectory)" Command="$(NodeCli) install -D tailwindcss" />
  </Target>

  <Target Name="TailwindCssCompile" BeforeTargets="Build" AfterTargets="DebugEnsureNode">
    <Message Importance="high" Text="TailwindCSS: Compiling from config $(TailwindCssConfigFile)" />

    <Exec WorkingDirectory="$(MSBuildProjectDirectory)/../" Command="&quot;$(NodeXCli)&quot; $(TailwindCssCli) -c &quot;$(TailwindCssConfigFile)&quot; -i &quot;$(TailwindCssInputFile)&quot; -o &quot;$(TailwindCssOutputFile)&quot; $(TailwindCssMinifyCommand)" />
  </Target>
</Project>